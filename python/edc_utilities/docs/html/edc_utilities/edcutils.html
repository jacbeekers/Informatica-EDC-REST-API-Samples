<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.9.2" />
<title>edc_utilities.edcutils API documentation</title>
<meta name="description" content="Created on Aug 2, 2018 â€¦" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>edc_utilities.edcutils</code></h1>
</header>
<section id="section-intro">
<p>Created on Aug 2, 2018</p>
<p>utility functions for processing catalog objects</p>
<p>@author: dwrigley</p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">&#34;&#34;&#34;
Created on Aug 2, 2018

utility functions for processing catalog objects

@author: dwrigley
&#34;&#34;&#34;

import json
import os

import requests
from requests.auth import HTTPBasicAuth


def get_fact_value(item, attribute_name, json_property):
    &#34;&#34;&#34;
    returns the value of a fact (attribute) from an item

    iterates over the &#34;facts&#34; list - looking for a matching attributeId
    to the parameter attribute_name
    returns the &#34;value&#34; json_property or &#34;&#34;
    &#34;&#34;&#34;
    # get the value of a specific fact from an item
    value = &#34;&#34;
    for facts in item[&#34;facts&#34;]:
        if facts.get(&#34;attributeId&#34;) == attribute_name:
            value = facts.get(json_property)
            if value is None:
                value = &#34;&#34;
            break
    return value


def exportLineageLink(fromObject, toObject, linkType, csvFile):
    &#34;&#34;&#34;
    write a custom lineage line to the csv file
    assumptions
      - csvFile is already created
      - csv header is Association,From Connection,To Connection,From Object,To Object
    Association=linkType, From Object=fromObject,To Object=toObject
    From Connection and To Connection will be empty
    &#34;&#34;&#34;
    # TODO: add error checking
    row = [linkType, &#34;&#34;, &#34;&#34;, fromObject, toObject]
    csvFile.writerow(row)
    return


def getAllResource(url, user, pWd):
    &#34;&#34;&#34;
    get the resource definition - given a resource name (and catalog url)
    catalog url should stop at port (e.g. not have ldmadmin, ldmcatalog etc...
    or have v2 anywhere
    since we are using v1 api&#39;s

    returns rc=200 (valid) &amp; other rc&#39;s from the get
            resourceDef (json)

    &#34;&#34;&#34;

    print(&#34;getting resource for catalog:-&#34; + url + &#34; user=&#34; + user)
    apiURL = url + &#34;/access/1/catalog/resources/&#34;
    # print(&#34;\turl=&#34; + apiURL)
    header = {&#34;Accept&#34;: &#34;application/json&#34;}
    tResp = requests.get(
        apiURL, params={}, headers=header, auth=HTTPBasicAuth(user, pWd), verify=False
    )
    print(&#34;\tresponse=&#34; + str(tResp.status_code))
    if tResp.status_code == 200:
        # valid - return the jsom
        return tResp.status_code, json.loads(tResp.text)
    else:
        # not valid
        return tResp.status_code, None


def getResourceDefUsingSession(url, session, resourceName, sensitiveOptions=False):
    &#34;&#34;&#34;
    get the resource definition - given a resource name (and catalog url)
    catalog url should stop at port (e.g. not have ldmadmin, ldmcatalog etc...
    or have v2 anywhere
    since we are using v1 api&#39;s

    returns rc=200 (valid) &amp; other rc&#39;s from the get
            resourceDef (json)

    &#34;&#34;&#34;

    print(
        &#34;getting resource for catalog:-&#34;
        + url
        + &#34; resource=&#34;
        + resourceName
    )
    apiURL = url + &#34;/access/1/catalog/resources/&#34; + resourceName
    if sensitiveOptions:
        apiURL += &#34;?sensitiveOptions=true&#34;
    # print(&#34;\turl=&#34; + apiURL)
    header = {&#34;Accept&#34;: &#34;application/json&#34;}
    tResp = session.get(apiURL, params={}, headers=header, )
    print(&#34;\tresponse=&#34; + str(tResp.status_code))
    if tResp.status_code == 200:
        # valid - return the jsom
        return tResp.status_code, json.loads(tResp.text)
    else:
        # not valid
        return tResp.status_code, None


def getResourceDef(url, user, pWd, resourceName, sensitiveOptions=False):
    &#34;&#34;&#34;
    get the resource definition - given a resource name (and catalog url)
    catalog url should stop at port (e.g. not have ldmadmin, ldmcatalog etc...
    or have v2 anywhere
    since we are using v1 api&#39;s

    returns rc=200 (valid) &amp; other rc&#39;s from the get
            resourceDef (json)

    &#34;&#34;&#34;

    print(
        &#34;getting resource for catalog:-&#34;
        + url
        + &#34; resource=&#34;
        + resourceName
        + &#34; user=&#34;
        + user
    )
    apiURL = url + &#34;/access/1/catalog/resources/&#34; + resourceName
    if sensitiveOptions:
        apiURL += &#34;?sensitiveOptions=true&#34;
    # print(&#34;\turl=&#34; + apiURL)
    header = {&#34;Accept&#34;: &#34;application/json&#34;}
    tResp = requests.get(
        apiURL, params={}, headers=header, auth=HTTPBasicAuth(user, pWd), verify=False
    )
    print(&#34;\tresponse=&#34; + str(tResp.status_code))
    if tResp.status_code == 200:
        # valid - return the jsom
        return tResp.status_code, json.loads(tResp.text)
    else:
        # not valid
        return tResp.status_code, None


def updateResourceDef(url, user, pWd, resourceName, resJson):
    &#34;&#34;&#34;
    update a setting in an existing resource

    returns rc=200 (valid) &amp; other rc&#39;s from the put
            resourceDef (json)

    &#34;&#34;&#34;

    print(
        &#34;\tupdating resource for catalog:-&#34;
        + url
        + &#34; resource=&#34;
        + resourceName
        + &#34; user=&#34;
        + user
    )
    print(&#34;\t&#34; + json.dumps(resJson))
    apiURL = url + &#34;/access/1/catalog/resources/&#34; + resourceName
    print(&#34;\turl=&#34; + apiURL)
    header = {&#34;Accept&#34;: &#34;application/json&#34;, &#34;Content-Type&#34;: &#34;application/json&#34;}
    tResp = requests.put(
        apiURL,
        data=json.dumps(resJson),
        headers=header,
        auth=HTTPBasicAuth(user, pWd),
        verify=False,
    )
    print(&#34;\tresponse=&#34; + str(tResp.status_code))
    if tResp.status_code == 200:
        # valid - return the jsom
        print(&#34;\tyay - update resource worked...&#34;)
        print(tResp)
        return tResp.status_code
    else:
        # not valid
        print(&#34;\tdarn - update resource failed...&#34;)
        print(tResp)
        return tResp.status_code


def createResource(url, user, pWd, resourceName, resourceJson):
    &#34;&#34;&#34;
    create a new resource based on the provided JSON

    returns rc=200 (valid) &amp; other rc&#39;s from the put
            resourceDef (json)

    &#34;&#34;&#34;
    # create a new resource
    apiURL = url + &#34;/access/1/catalog/resources/&#34;
    header = {&#34;content-type&#34;: &#34;application/json&#34;}
    print(&#34;\tcreating resource: &#34; + resourceName)
    newResourceResp = requests.post(
        apiURL,
        data=json.dumps(resourceJson),
        headers=header,
        auth=HTTPBasicAuth(user, pWd),
        verify=False,
    )
    print(&#34;\trc=&#34; + str(newResourceResp.status_code))
    print(&#34;\tbody=&#34; + str(newResourceResp.text))

    return newResourceResp.status_code


def createResourceUsingSession(url, session, resourceName, resourceJson):
    &#34;&#34;&#34;
    create a new resource based on the provided JSON
    using a session that already has the auth (credentials)

    returns rc=200 (valid) &amp; other rc&#39;s from the put
            resourceDef (json)

    &#34;&#34;&#34;
    # create a new resource
    apiURL = url + &#34;/access/1/catalog/resources/&#34;
    header = {&#34;content-type&#34;: &#34;application/json&#34;}
    print(&#34;\tcreating resource: &#34; + resourceName)
    newResourceResp = session.post(
        apiURL, data=json.dumps(resourceJson), headers=header
    )
    print(&#34;\trc=&#34; + str(newResourceResp.status_code))
    # print(&#34;\tbody=&#34; + str(newResourceResp.text))

    return newResourceResp.status_code


def uploadResourceFileUsingSession(url, session, resourceName, fileName, fullPath, scannerId):
    &#34;&#34;&#34;
    upload a file for the resource - e.g. a custom lineage csv file
    works with either csv for zip files  (.csv|.zip)

    returns rc=200 (valid) &amp; other rc&#39;s from the post

    &#34;&#34;&#34;
    print(
        &#34;uploading file for resource &#34;
        + url
        + &#34; resource=&#34;
        + resourceName
    )
    apiURL = url + &#34;/access/1/catalog/resources/&#34; + resourceName + &#34;/files&#34;
    print(&#34;\turl=&#34; + apiURL)
    # header = {&#34;accept&#34;: &#34;*/*&#34;, }
    params = {&#34;scannerid&#34;: scannerId, &#34;filename&#34;: fileName, &#34;optionid&#34;: &#34;File&#34;}
    print(&#34;\t&#34; + str(params))
    #     files = {&#39;file&#39;: fullPath}
    mimeType = &#34;text/csv&#34;
    readMode = &#34;rt&#34;
    if fileName.endswith(&#34;.zip&#34;):
        mimeType = &#34;application/zip&#34;
        readMode = &#34;rb&#34;

    if fileName.endswith(&#34;.dsx&#34;):
        mimeType = &#34;text/plain&#34;

    file = {&#34;file&#34;: (fileName, open(fullPath, readMode), mimeType)}
    # file = {&#34;file&#34;: (fileName, open(fullPath, readMode), )}
    print(f&#34;\t{file}&#34;)
    # print(f&#34;session header:{session.headers}&#34;)
    uploadResp = session.post(
        apiURL,
        data=params,
        files=file,
    )
    print(&#34;\tresponse=&#34; + str(uploadResp.status_code))
    if uploadResp.status_code == 200:
        # valid - return the json
        return uploadResp.status_code
    else:
        # not valid
        print(&#34;\tupload file failed&#34;)
        print(&#34;\t&#34; + str(uploadResp))
        print(&#34;\t&#34; + str(uploadResp.text))
        return uploadResp.status_code


def uploadResourceFile(url, user, pWd, resourceName, fileName, fullPath, scannerId):
    &#34;&#34;&#34;
    upload a file for the resource - e.g. a custom lineage csv file
    works with either csv for zip files  (.csv|.zip)

    returns rc=200 (valid) &amp; other rc&#39;s from the post

    &#34;&#34;&#34;
    print(
        &#34;uploading file for resource &#34;
        + url
        + &#34; resource=&#34;
        + resourceName
        + &#34; user=&#34;
        + user
    )
    apiURL = url + &#34;/access/1/catalog/resources/&#34; + resourceName + &#34;/files&#34;
    print(&#34;\turl=&#34; + apiURL)
    # header = {&#34;accept&#34;: &#34;*/*&#34;, &#34;Content-Type&#34; : &#34;multipart/form-data&#34;}
    header = {&#34;accept&#34;: &#34;*/*&#34;}
    print(&#34;\t&#34; + str(header))
    # params={&#34;scannerid&#34;: &#34;LineageScanner&#34;, &#34;filename&#34;: fileName, &#34;optionid&#34;: &#34;File&#34;}
    params = {&#34;scannerid&#34;: scannerId, &#34;filename&#34;: fileName, &#34;optionid&#34;: &#34;File&#34;}
    print(&#34;\t&#34; + str(params))
    #     files = {&#39;file&#39;: fullPath}
    mimeType = &#34;text/csv&#34;
    readMode = &#34;rt&#34;
    if fileName.endswith(&#34;.zip&#34;):
        mimeType = &#34;application/zip&#34;
        readMode = &#34;rb&#34;

    if fileName.endswith(&#34;.dsx&#34;):
        mimeType = &#34;text/plain&#34;

    file = {&#34;file&#34;: (fileName, open(fullPath, readMode), mimeType)}
    print(&#34;\t&#34; + str(file))
    uploadResp = requests.post(
        apiURL,
        data=params,
        files=file,
        headers=header,
        auth=HTTPBasicAuth(user, pWd),
        verify=False,
    )
    print(&#34;\tresponse=&#34; + str(uploadResp.status_code))
    if uploadResp.status_code == 200:
        # valid - return the jsom
        return uploadResp.status_code
    else:
        # not valid
        print(&#34;\tupload file failed&#34;)
        print(&#34;\t&#34; + str(uploadResp))
        print(&#34;\t&#34; + str(uploadResp.text))
        return uploadResp.status_code


def executeResourceLoadUsingSession(url, session, resourceName):
    &#34;&#34;&#34;
    start a resource load

    returns rc=200 (valid) &amp; other rc&#39;s from the get
            json with the job details

    &#34;&#34;&#34;

    print(&#34;starting scan resource &#34; + url + &#34; resource=&#34; + resourceName)
    apiURL = url + &#34;/access/2/catalog/resources/jobs/loads&#34;
    print(&#34;\turl=&#34; + apiURL)
    header = {&#34;accept&#34;: &#34;application/json&#34;, &#34;Content-Type&#34;: &#34;application/json&#34;}
    print(&#34;\t&#34; + str(header))
    params = {&#34;resourceName&#34;: resourceName}
    print(&#34;\t&#34; + str(params))
    uploadResp = session.post(apiURL, data=json.dumps(params), headers=header)
    print(&#34;\tresponse=&#34; + str(uploadResp.status_code))
    if uploadResp.status_code == 200:
        # valid - return the jsom
        return uploadResp.status_code, json.loads(uploadResp.text)
    else:
        # not valid
        print(&#34;\tdarn - resource start failed&#34;)
        print(&#34;\t&#34; + str(uploadResp))
        print(&#34;\t&#34; + str(uploadResp.text))
        return uploadResp.status_code, None


def executeResourceLoad(url, user, pWd, resourceName):
    &#34;&#34;&#34;
    start a resource load

    returns rc=200 (valid) &amp; other rc&#39;s from the get
            json with the job details

    &#34;&#34;&#34;

    print(
        &#34;starting scan resource &#34; + url + &#34; resource=&#34; + resourceName + &#34; user=&#34; + user
    )
    apiURL = url + &#34;/access/2/catalog/resources/jobs/loads&#34;
    print(&#34;\turl=&#34; + apiURL)
    header = {&#34;accept&#34;: &#34;application/json&#34;, &#34;Content-Type&#34;: &#34;application/json&#34;}
    print(&#34;\t&#34; + str(header))
    params = {&#34;resource_name&#34;: resourceName}
    print(&#34;\t&#34; + str(params))
    uploadResp = requests.post(
        apiURL,
        data=json.dumps(params),
        headers=header,
        auth=HTTPBasicAuth(user, pWd),
        verify=False,
    )
    print(&#34;\tresponse=&#34; + str(uploadResp.status_code))
    if uploadResp.status_code == 200:
        # valid - return the jsom
        return uploadResp.status_code, json.loads(uploadResp.text)
    else:
        # not valid
        print(&#34;\tdarn - resource start failed&#34;)
        print(&#34;\t&#34; + str(uploadResp))
        print(&#34;\t&#34; + str(uploadResp.text))
        return uploadResp.status_code, None


# start

def createOrUpdateAndExecuteResourceUsingSession(
        url,
        session,
        resourceName,
        templateFileName,
        fileName,
        inputFileFullPath,
        waitForComplete,
        scannerId,
):
    &#34;&#34;&#34;
    create or update resource_name  (new way with sessions)
    upload a file
    execute the scan
    optionally wait for the scan to complete

    assumption - from the template, we are only changing the resource name,
                 and filename options - all else is already in the template

    @todo:  add a diff process to determine if the input file is different to last time
            - assume last file ins in what folder???
    &#34;&#34;&#34;
    # check if the file to be uploaded exists
    if os.path.isfile(inputFileFullPath):

        # check if the file is different from /prev
        # if /prev/&lt;file&gt; either does not exist, or is different
        #   proceed
        #
        # else  (file content is the same)
        #   do nothing

        # get existing resource (so we know to create it or update it)
        validResource = False
        rc, rj = getResourceDefUsingSession(url, session, resourceName)

        if rc == 200:
            validResource = True
            # valid resource
            print(&#34;\tresource is valid: &#34; + resourceName)
            print(&#34;\tchecking for file name change...&#34;)
            # print(rj)

            # check the file name in the json results
            isResChanged = False
            # check if the resource file name is the same as the file we are uploading
            for config in rj[&#34;scannerConfigurations&#34;]:
                for opt in config[&#34;configOptions&#34;]:
                    optId = opt.get(&#34;optionId&#34;)
                    optVals = opt.get(&#34;optionValues&#34;)
                    # print (opt)
                    if optId == &#34;File&#34;:
                        print(&#34;\t     file=&#34; + str(optVals))
                        print(&#34;\tcheckiung:&#34; + fileName)
                        if fileName in optVals:
                            print(&#34;\t\tfile name is same...&#34;)
                        else:
                            print(&#34;\t\tfile name different&#34;)
                            isResChanged = True
                            # replace the optionValues content (the file name)
                            opt[&#34;optionValues&#34;] = [fileName]

            # if the properties of the resource changed, update it
            if isResChanged:
                # save the resource def
                print(&#34;saving resource def...&#34;)
            #                updRc = updateResourceDefUsingSession(url, session, resourceName, rj)
            #                print(updRc)
            #                if updRc == 200:
            #                    print(&#34;update succeeded&#34;)
            #                else:
            #                    print(&#34;update failed&#34;)
            #                    print(&#34;resource could be out of sync - load might fail&#34;)
            else:
                print(&#34;\tno changes to resource def...&#34;)

        else:
            print(&#34;\tneed to create resource: %s&#34; % resourceName)
            # check the template file exists
            if os.path.isfile(templateFileName):
                # create resource using this template
                # newResourceJson = json.load(lineageResourceTemplate)
                with open(templateFileName) as json_data:
                    templateJson = json.load(json_data)

                # print(templateJson)
                # set the resource name
                templateJson[&#34;resourceIdentifier&#34;][&#34;resource_name&#34;] = resourceName

                # print(templateJson)
                # set the File json_property (in configOptions)
                for config in templateJson[&#34;scannerConfigurations&#34;]:
                    for opt in config[&#34;configOptions&#34;]:
                        optId = opt.get(&#34;optionId&#34;)
                        optVals = opt.get(&#34;optionValues&#34;)
                        if optId == &#34;File&#34;:
                            opt[&#34;optionValues&#34;] = [fileName]

                # print(templateJson)
                createRc = createResourceUsingSession(url, session, resourceName, templateJson)
                if createRc == 200:
                    validResource = True
                else:
                    print(&#34;error creating resource: cannot upload file and scan&#34;)

            else:
                print(&#34;lineage template file does not exist: &#34; + templateFileName)

        # if the resource is valid
        # (either created as new, or updated with new file name)
        if validResource:
            # upload the new file
            print(
                &#34;uploading file&#34;
                + &#34; &#34;
                + inputFileFullPath
                + &#34; to resource: &#34;
                + resourceName
            )
            uploadRc = uploadResourceFileUsingSession(
                url, session, resourceName, fileName, inputFileFullPath, scannerId
            )
            # print(uploadRc)

            # if the file was uploaded - start the resource load
            if uploadRc == 200:
                print(&#34;starting resource load: &#34; + resourceName)
                loadRc, loadJson = executeResourceLoadUsingSession(url, session, resourceName)
                if loadRc == 200:
                    # print(loadJson)
                    print(&#34;\tJob Queued: &#34; + loadJson.get(&#34;jobId&#34;))
                    print(&#34;\tJob def: &#34; + str(loadJson))

                    if waitForComplete:
                        print(&#34;waiting for job completion is not implemented yet&#34;)
                else:
                    print(&#34;\tjob not started &#34; + str(loadRc))
            else:
                print(&#34;file not uploaded - resource/scan will not be started&#34;)

    else:
        # file does not exist
        print(
            &#34;resource input file: &#34;
            + inputFileFullPath
            + &#34; invalid or does not exist, exiting&#34;
        )


# end


def createOrUpdateAndExecuteResource(
        url,
        user,
        pwd,
        resourceName,
        templateFileName,
        fileName,
        inputFileFullPath,
        waitForComplete,
        scannerId,
):
    &#34;&#34;&#34;
    create or update resource_name   (note: old way - consider moving to sessions (better for id/pwd/ssl validation))
    upload a file
    execute the scan
    optionally wait for the scan to complete

    assumption - from the template, we are only changing the resource name,
                 and filename options - all else is already in the template

    @todo:  add a diff process to determine if the input file is different to last time
            - assume last file ins in what folder???
    &#34;&#34;&#34;
    # check if the file to be uploaded exists
    if os.path.isfile(inputFileFullPath):

        # check if the file is different from /prev
        # if /prev/&lt;file&gt; either does not exist, or is different
        #   proceed
        #
        # else  (file content is the same)
        #   do nothing

        # get existing resource (so we know to create it or update it)
        validResource = False
        rc, rj = getResourceDef(url, user, pwd, resourceName)

        if rc == 200:
            validResource = True
            # valid resource
            print(&#34;\tresource is valid: &#34; + resourceName)
            print(&#34;\tchecking for file name change...&#34;)
            # print(rj)

            # check the file name in the json results
            isResChanged = False
            # check if the resource file name is the same as the file we are uploading
            for config in rj[&#34;scannerConfigurations&#34;]:
                for opt in config[&#34;configOptions&#34;]:
                    optId = opt.get(&#34;optionId&#34;)
                    optVals = opt.get(&#34;optionValues&#34;)
                    # print (opt)
                    if optId == &#34;File&#34;:
                        print(&#34;\t     file=&#34; + str(optVals))
                        print(&#34;\tcheckiung:&#34; + fileName)
                        if fileName in optVals:
                            print(&#34;\t\tfile name is same...&#34;)
                        else:
                            print(&#34;\t\tfile name different&#34;)
                            isResChanged = True
                            # replace the optionValues content (the file name)
                            opt[&#34;optionValues&#34;] = [fileName]

            # if the properties of the resource changed, update it
            if isResChanged:
                # save the resource def
                print(&#34;saving resource def...&#34;)
                updRc = updateResourceDef(url, user, pwd, resourceName, rj)
                print(updRc)
                if updRc == 200:
                    print(&#34;update succeeded&#34;)
                else:
                    print(&#34;update failed&#34;)
                    print(&#34;resource could be out of sync - load might fail&#34;)
            else:
                print(&#34;\tno changes to resource def...&#34;)

        else:
            print(&#34;\tneed to create resource: %s&#34; % resourceName)
            # check the template file exists
            if os.path.isfile(templateFileName):
                # create resource using this template
                # newResourceJson = json.load(lineageResourceTemplate)
                with open(templateFileName) as json_data:
                    templateJson = json.load(json_data)

                # print(templateJson)
                # set the resource name
                templateJson[&#34;resourceIdentifier&#34;][&#34;resource_name&#34;] = resourceName

                # print(templateJson)
                # set the File json_property (in configOptions)
                for config in templateJson[&#34;scannerConfigurations&#34;]:
                    for opt in config[&#34;configOptions&#34;]:
                        optId = opt.get(&#34;optionId&#34;)
                        optVals = opt.get(&#34;optionValues&#34;)
                        if optId == &#34;File&#34;:
                            opt[&#34;optionValues&#34;] = [fileName]

                # print(templateJson)
                createRc = createResource(url, user, pwd, resourceName, templateJson)
                if createRc == 200:
                    validResource = True
                else:
                    print(&#34;error creating resource: cannot upload file and scan&#34;)

            else:
                print(&#34;lineage template file does not exist: &#34; + templateFileName)

        # if the resource is valid
        # (either created as new, or updated with new file name)
        if validResource:
            # upload the new file
            print(
                &#34;uploading file&#34;
                + &#34; &#34;
                + inputFileFullPath
                + &#34; to resource: &#34;
                + resourceName
            )
            uploadRc = uploadResourceFile(
                url, user, pwd, resourceName, fileName, inputFileFullPath, scannerId
            )
            # print(uploadRc)

            # if the file was uploaded - start the resource load
            if uploadRc == 200:
                print(&#34;starting resource load: &#34; + resourceName)
                loadRc, loadJson = executeResourceLoad(url, user, pwd, resourceName)
                if loadRc == 200:
                    # print(loadJson)
                    print(&#34;\tJob Queued: &#34; + loadJson.get(&#34;jobId&#34;))
                    print(&#34;\tJob def: &#34; + str(loadJson))

                    if waitForComplete:
                        print(&#34;waiting for job completion is not implemented yet&#34;)
                else:
                    print(&#34;\tjob not started &#34; + str(loadRc))
            else:
                print(&#34;file not uploaded - resource/scan will not be started&#34;)

    else:
        # file does not exist
        print(
            &#34;resource input file: &#34;
            + inputFileFullPath
            + &#34; invalid or does not exist, exiting&#34;
        )


def callGETRestEndpoint(apiURL, user, pWd):
    &#34;&#34;&#34;
    this function call the URL  with a GET method and return the status code
    as well as the response body
    returns rc=200 (valid) &amp; other rc&#39;s from the get
            resourceDef (json)
    &#34;&#34;&#34;
    header = {&#34;Accept&#34;: &#34;application/json&#34;}
    tResp = requests.get(
        apiURL, params={}, headers=header, auth=HTTPBasicAuth(user, pWd), verify=False
    )
    print(&#34;\tresponse=&#34; + str(tResp.status_code))
    if tResp.status_code == 200:
        # valid - return the jsom
        return tResp.status_code, json.loads(tResp.text)
    else:
        # not valid
        return tResp.status_code, None


def getResourceObjectCount(url, user, pWd, resourceName):
    &#34;&#34;&#34;
    get the resource object count - given a resource name (and catalog url)
    &#34;&#34;&#34;

    apiURL = url + &#34;/access/2/catalog/data/objects?q=core.resource_name:&#34; + resourceName
    print(
        &#34;getting object count for catalog resource:-&#34;
        + apiURL
        + &#34; resource=&#34;
        + resourceName
        + &#34; user=&#34;
        + user
    )
    return callGETRestEndpoint(apiURL, user, pWd)


def getCatalogObjectCount(url, user, pWd):
    &#34;&#34;&#34;
    get the resource object count - given a catalog url
    &#34;&#34;&#34;

    print(&#34;getting object count for catalog resource:-&#34; + url + &#34; user=&#34; + user)
    apiURL = url + &#34;/access/2/catalog/data/objects&#34;
    return callGETRestEndpoint(apiURL, user, pWd)


def getCatalogResourceCount(url, user, pWd):
    &#34;&#34;&#34;
    get the resource count - given a catalog url
    &#34;&#34;&#34;

    apiURL = url + &#34;/access/2/catalog/data/objects?q=core.allclassTypes:core.Resource&#34;
    print(&#34;getting object count for catalog resource:-&#34; + apiURL + &#34; user=&#34; + user)
    return callGETRestEndpoint(apiURL, user, pWd)


def getReusableScannerConfig(url, user, pWd):
    &#34;&#34;&#34;
    get the reusable configuration - given a catalog url
    &#34;&#34;&#34;

    apiURL = url + &#34;/access/1/catalog/resources/reusablescannerconfigs&#34;
    print(&#34;getting the reusable configuration:-&#34; + apiURL + &#34; user=&#34; + user)
    return callGETRestEndpoint(apiURL, user, pWd)


def getCatalogCustomAttr(url, user, pWd):
    &#34;&#34;&#34;
    call GET /access/2/catalog/models/attributes
    this returns all attributes (system + custom)
    filter for only the custom attributes (id startswith &#34;com.infa.appmodels.ldm.&#34;
    &#34;&#34;&#34;

    resturl = url + &#34;/access/2/catalog/models/attributes&#34;
    header = {&#34;Accept&#34;: &#34;application/json&#34;}

    # set initial value for total to &gt; 0 - is over-written by the count of objects found
    total = 1000
    offset = 0
    page = 0
    pageSize = 200

    customAttrs = []

    while offset &lt; total:
        page += 1
        parameters = {&#34;offset&#34;: offset, &#34;pageSize&#34;: pageSize}

        # execute catalog rest call, for a page of results
        resp = requests.get(
            resturl,
            params=parameters,
            headers=header,
            auth=HTTPBasicAuth(user, pWd),
            verify=False,
        )
        status = resp.status_code
        if status != 200:
            # some error - e.g. catalog not running, or bad credentials
            print(&#34;error! &#34; + str(status) + str(resp.json()))
            break

        resultJson = resp.json()
        total = resultJson[&#34;metadata&#34;][&#34;totalCount&#34;]
        print(
            &#34;objects found: &#34;
            + str(total)
            + &#34; processing:&#34;
            + str(offset + 1)
            + &#34;-&#34;
            + str(offset + pageSize)
            + &#34; pagesize=&#34;
            + str(pageSize)
            + &#34; currentPage=&#34;
            + str(page)
        )

        # for next iteration
        offset += pageSize

        # for each attribute found...
        for attrDef in resultJson[&#34;items&#34;]:
            # attrCount+=1
            attrId = attrDef[&#34;id&#34;]
            if attrId.startswith(&#34;com.infa.appmodels.ldm.&#34;):
                customAttrs.append(attrDef)

    # end of while loop
    # print(&#34;&#34;)
    # print(&#34;Finished - run time = %s seconds ---&#34; % (time.time() - start_time))
    return customAttrs


def createAttribute(url, user, pWd, attrJson):
    &#34;&#34;&#34;
    create a new attribute
    attrJSON must be in the form
        {
          &#34;items&#34;: [
            {
              &#34;analyzer&#34;: &#34;INT&#34;,
              &#34;boost&#34;: &#34;LOWEST&#34;,
              &#34;classes&#34;: [
                {
                  &#34;id&#34;: &#34;string&#34;
                }
              ],
              &#34;dataTypeId&#34;: &#34;string&#34;,
              &#34;description&#34;: &#34;string&#34;,
              &#34;facetable&#34;: false,
              &#34;multivalued&#34;: false,
              &#34;name&#34;: &#34;string&#34;,
              &#34;searchable&#34;: false,
              &#34;sortable&#34;: false,
              &#34;suggestable&#34;: false
            }
          ]
        }

    &#34;&#34;&#34;
    apiURL = url + &#34;/access/2/catalog/models/attributes/&#34;
    header = {&#34;content-type&#34;: &#34;application/json&#34;}
    print(&#34;\tcreating custom attribute: &#34; + attrJson[&#34;items&#34;][0][&#34;name&#34;])
    newAttrResp = requests.post(
        apiURL,
        data=json.dumps(attrJson),
        headers=header,
        auth=HTTPBasicAuth(user, pWd),
        verify=False,
    )
    print(&#34;\trc=&#34; + str(newAttrResp.status_code))
    print(&#34;\tbody=&#34; + str(newAttrResp.text))
    print(attrJson)

    return newAttrResp.status_code</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="edc_utilities.edcutils.callGETRestEndpoint"><code class="name flex">
<span>def <span class="ident">callGETRestEndpoint</span></span>(<span>apiURL, user, pWd)</span>
</code></dt>
<dd>
<div class="desc"><p>this function call the URL
with a GET method and return the status code
as well as the response body
returns rc=200 (valid) &amp; other rc's from the get
resourceDef (json)</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def callGETRestEndpoint(apiURL, user, pWd):
    &#34;&#34;&#34;
    this function call the URL  with a GET method and return the status code
    as well as the response body
    returns rc=200 (valid) &amp; other rc&#39;s from the get
            resourceDef (json)
    &#34;&#34;&#34;
    header = {&#34;Accept&#34;: &#34;application/json&#34;}
    tResp = requests.get(
        apiURL, params={}, headers=header, auth=HTTPBasicAuth(user, pWd), verify=False
    )
    print(&#34;\tresponse=&#34; + str(tResp.status_code))
    if tResp.status_code == 200:
        # valid - return the jsom
        return tResp.status_code, json.loads(tResp.text)
    else:
        # not valid
        return tResp.status_code, None</code></pre>
</details>
</dd>
<dt id="edc_utilities.edcutils.createAttribute"><code class="name flex">
<span>def <span class="ident">createAttribute</span></span>(<span>url, user, pWd, attrJson)</span>
</code></dt>
<dd>
<div class="desc"><p>create a new attribute
attrJSON must be in the form
{
"items": [
{
"analyzer": "INT",
"boost": "LOWEST",
"classes": [
{
"id": "string"
}
],
"dataTypeId": "string",
"description": "string",
"facetable": false,
"multivalued": false,
"name": "string",
"searchable": false,
"sortable": false,
"suggestable": false
}
]
}</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def createAttribute(url, user, pWd, attrJson):
    &#34;&#34;&#34;
    create a new attribute
    attrJSON must be in the form
        {
          &#34;items&#34;: [
            {
              &#34;analyzer&#34;: &#34;INT&#34;,
              &#34;boost&#34;: &#34;LOWEST&#34;,
              &#34;classes&#34;: [
                {
                  &#34;id&#34;: &#34;string&#34;
                }
              ],
              &#34;dataTypeId&#34;: &#34;string&#34;,
              &#34;description&#34;: &#34;string&#34;,
              &#34;facetable&#34;: false,
              &#34;multivalued&#34;: false,
              &#34;name&#34;: &#34;string&#34;,
              &#34;searchable&#34;: false,
              &#34;sortable&#34;: false,
              &#34;suggestable&#34;: false
            }
          ]
        }

    &#34;&#34;&#34;
    apiURL = url + &#34;/access/2/catalog/models/attributes/&#34;
    header = {&#34;content-type&#34;: &#34;application/json&#34;}
    print(&#34;\tcreating custom attribute: &#34; + attrJson[&#34;items&#34;][0][&#34;name&#34;])
    newAttrResp = requests.post(
        apiURL,
        data=json.dumps(attrJson),
        headers=header,
        auth=HTTPBasicAuth(user, pWd),
        verify=False,
    )
    print(&#34;\trc=&#34; + str(newAttrResp.status_code))
    print(&#34;\tbody=&#34; + str(newAttrResp.text))
    print(attrJson)

    return newAttrResp.status_code</code></pre>
</details>
</dd>
<dt id="edc_utilities.edcutils.createOrUpdateAndExecuteResource"><code class="name flex">
<span>def <span class="ident">createOrUpdateAndExecuteResource</span></span>(<span>url, user, pwd, resourceName, templateFileName, fileName, inputFileFullPath, waitForComplete, scannerId)</span>
</code></dt>
<dd>
<div class="desc"><p>create or update resource_name
(note: old way - consider moving to sessions (better for id/pwd/ssl validation))
upload a file
execute the scan
optionally wait for the scan to complete</p>
<p>assumption - from the template, we are only changing the resource name,
and filename options - all else is already in the template</p>
<p>@todo:
add a diff process to determine if the input file is different to last time
- assume last file ins in what folder???</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def createOrUpdateAndExecuteResource(
        url,
        user,
        pwd,
        resourceName,
        templateFileName,
        fileName,
        inputFileFullPath,
        waitForComplete,
        scannerId,
):
    &#34;&#34;&#34;
    create or update resource_name   (note: old way - consider moving to sessions (better for id/pwd/ssl validation))
    upload a file
    execute the scan
    optionally wait for the scan to complete

    assumption - from the template, we are only changing the resource name,
                 and filename options - all else is already in the template

    @todo:  add a diff process to determine if the input file is different to last time
            - assume last file ins in what folder???
    &#34;&#34;&#34;
    # check if the file to be uploaded exists
    if os.path.isfile(inputFileFullPath):

        # check if the file is different from /prev
        # if /prev/&lt;file&gt; either does not exist, or is different
        #   proceed
        #
        # else  (file content is the same)
        #   do nothing

        # get existing resource (so we know to create it or update it)
        validResource = False
        rc, rj = getResourceDef(url, user, pwd, resourceName)

        if rc == 200:
            validResource = True
            # valid resource
            print(&#34;\tresource is valid: &#34; + resourceName)
            print(&#34;\tchecking for file name change...&#34;)
            # print(rj)

            # check the file name in the json results
            isResChanged = False
            # check if the resource file name is the same as the file we are uploading
            for config in rj[&#34;scannerConfigurations&#34;]:
                for opt in config[&#34;configOptions&#34;]:
                    optId = opt.get(&#34;optionId&#34;)
                    optVals = opt.get(&#34;optionValues&#34;)
                    # print (opt)
                    if optId == &#34;File&#34;:
                        print(&#34;\t     file=&#34; + str(optVals))
                        print(&#34;\tcheckiung:&#34; + fileName)
                        if fileName in optVals:
                            print(&#34;\t\tfile name is same...&#34;)
                        else:
                            print(&#34;\t\tfile name different&#34;)
                            isResChanged = True
                            # replace the optionValues content (the file name)
                            opt[&#34;optionValues&#34;] = [fileName]

            # if the properties of the resource changed, update it
            if isResChanged:
                # save the resource def
                print(&#34;saving resource def...&#34;)
                updRc = updateResourceDef(url, user, pwd, resourceName, rj)
                print(updRc)
                if updRc == 200:
                    print(&#34;update succeeded&#34;)
                else:
                    print(&#34;update failed&#34;)
                    print(&#34;resource could be out of sync - load might fail&#34;)
            else:
                print(&#34;\tno changes to resource def...&#34;)

        else:
            print(&#34;\tneed to create resource: %s&#34; % resourceName)
            # check the template file exists
            if os.path.isfile(templateFileName):
                # create resource using this template
                # newResourceJson = json.load(lineageResourceTemplate)
                with open(templateFileName) as json_data:
                    templateJson = json.load(json_data)

                # print(templateJson)
                # set the resource name
                templateJson[&#34;resourceIdentifier&#34;][&#34;resource_name&#34;] = resourceName

                # print(templateJson)
                # set the File json_property (in configOptions)
                for config in templateJson[&#34;scannerConfigurations&#34;]:
                    for opt in config[&#34;configOptions&#34;]:
                        optId = opt.get(&#34;optionId&#34;)
                        optVals = opt.get(&#34;optionValues&#34;)
                        if optId == &#34;File&#34;:
                            opt[&#34;optionValues&#34;] = [fileName]

                # print(templateJson)
                createRc = createResource(url, user, pwd, resourceName, templateJson)
                if createRc == 200:
                    validResource = True
                else:
                    print(&#34;error creating resource: cannot upload file and scan&#34;)

            else:
                print(&#34;lineage template file does not exist: &#34; + templateFileName)

        # if the resource is valid
        # (either created as new, or updated with new file name)
        if validResource:
            # upload the new file
            print(
                &#34;uploading file&#34;
                + &#34; &#34;
                + inputFileFullPath
                + &#34; to resource: &#34;
                + resourceName
            )
            uploadRc = uploadResourceFile(
                url, user, pwd, resourceName, fileName, inputFileFullPath, scannerId
            )
            # print(uploadRc)

            # if the file was uploaded - start the resource load
            if uploadRc == 200:
                print(&#34;starting resource load: &#34; + resourceName)
                loadRc, loadJson = executeResourceLoad(url, user, pwd, resourceName)
                if loadRc == 200:
                    # print(loadJson)
                    print(&#34;\tJob Queued: &#34; + loadJson.get(&#34;jobId&#34;))
                    print(&#34;\tJob def: &#34; + str(loadJson))

                    if waitForComplete:
                        print(&#34;waiting for job completion is not implemented yet&#34;)
                else:
                    print(&#34;\tjob not started &#34; + str(loadRc))
            else:
                print(&#34;file not uploaded - resource/scan will not be started&#34;)

    else:
        # file does not exist
        print(
            &#34;resource input file: &#34;
            + inputFileFullPath
            + &#34; invalid or does not exist, exiting&#34;
        )</code></pre>
</details>
</dd>
<dt id="edc_utilities.edcutils.createOrUpdateAndExecuteResourceUsingSession"><code class="name flex">
<span>def <span class="ident">createOrUpdateAndExecuteResourceUsingSession</span></span>(<span>url, session, resourceName, templateFileName, fileName, inputFileFullPath, waitForComplete, scannerId)</span>
</code></dt>
<dd>
<div class="desc"><p>create or update resource_name
(new way with sessions)
upload a file
execute the scan
optionally wait for the scan to complete</p>
<p>assumption - from the template, we are only changing the resource name,
and filename options - all else is already in the template</p>
<p>@todo:
add a diff process to determine if the input file is different to last time
- assume last file ins in what folder???</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def createOrUpdateAndExecuteResourceUsingSession(
        url,
        session,
        resourceName,
        templateFileName,
        fileName,
        inputFileFullPath,
        waitForComplete,
        scannerId,
):
    &#34;&#34;&#34;
    create or update resource_name  (new way with sessions)
    upload a file
    execute the scan
    optionally wait for the scan to complete

    assumption - from the template, we are only changing the resource name,
                 and filename options - all else is already in the template

    @todo:  add a diff process to determine if the input file is different to last time
            - assume last file ins in what folder???
    &#34;&#34;&#34;
    # check if the file to be uploaded exists
    if os.path.isfile(inputFileFullPath):

        # check if the file is different from /prev
        # if /prev/&lt;file&gt; either does not exist, or is different
        #   proceed
        #
        # else  (file content is the same)
        #   do nothing

        # get existing resource (so we know to create it or update it)
        validResource = False
        rc, rj = getResourceDefUsingSession(url, session, resourceName)

        if rc == 200:
            validResource = True
            # valid resource
            print(&#34;\tresource is valid: &#34; + resourceName)
            print(&#34;\tchecking for file name change...&#34;)
            # print(rj)

            # check the file name in the json results
            isResChanged = False
            # check if the resource file name is the same as the file we are uploading
            for config in rj[&#34;scannerConfigurations&#34;]:
                for opt in config[&#34;configOptions&#34;]:
                    optId = opt.get(&#34;optionId&#34;)
                    optVals = opt.get(&#34;optionValues&#34;)
                    # print (opt)
                    if optId == &#34;File&#34;:
                        print(&#34;\t     file=&#34; + str(optVals))
                        print(&#34;\tcheckiung:&#34; + fileName)
                        if fileName in optVals:
                            print(&#34;\t\tfile name is same...&#34;)
                        else:
                            print(&#34;\t\tfile name different&#34;)
                            isResChanged = True
                            # replace the optionValues content (the file name)
                            opt[&#34;optionValues&#34;] = [fileName]

            # if the properties of the resource changed, update it
            if isResChanged:
                # save the resource def
                print(&#34;saving resource def...&#34;)
            #                updRc = updateResourceDefUsingSession(url, session, resourceName, rj)
            #                print(updRc)
            #                if updRc == 200:
            #                    print(&#34;update succeeded&#34;)
            #                else:
            #                    print(&#34;update failed&#34;)
            #                    print(&#34;resource could be out of sync - load might fail&#34;)
            else:
                print(&#34;\tno changes to resource def...&#34;)

        else:
            print(&#34;\tneed to create resource: %s&#34; % resourceName)
            # check the template file exists
            if os.path.isfile(templateFileName):
                # create resource using this template
                # newResourceJson = json.load(lineageResourceTemplate)
                with open(templateFileName) as json_data:
                    templateJson = json.load(json_data)

                # print(templateJson)
                # set the resource name
                templateJson[&#34;resourceIdentifier&#34;][&#34;resource_name&#34;] = resourceName

                # print(templateJson)
                # set the File json_property (in configOptions)
                for config in templateJson[&#34;scannerConfigurations&#34;]:
                    for opt in config[&#34;configOptions&#34;]:
                        optId = opt.get(&#34;optionId&#34;)
                        optVals = opt.get(&#34;optionValues&#34;)
                        if optId == &#34;File&#34;:
                            opt[&#34;optionValues&#34;] = [fileName]

                # print(templateJson)
                createRc = createResourceUsingSession(url, session, resourceName, templateJson)
                if createRc == 200:
                    validResource = True
                else:
                    print(&#34;error creating resource: cannot upload file and scan&#34;)

            else:
                print(&#34;lineage template file does not exist: &#34; + templateFileName)

        # if the resource is valid
        # (either created as new, or updated with new file name)
        if validResource:
            # upload the new file
            print(
                &#34;uploading file&#34;
                + &#34; &#34;
                + inputFileFullPath
                + &#34; to resource: &#34;
                + resourceName
            )
            uploadRc = uploadResourceFileUsingSession(
                url, session, resourceName, fileName, inputFileFullPath, scannerId
            )
            # print(uploadRc)

            # if the file was uploaded - start the resource load
            if uploadRc == 200:
                print(&#34;starting resource load: &#34; + resourceName)
                loadRc, loadJson = executeResourceLoadUsingSession(url, session, resourceName)
                if loadRc == 200:
                    # print(loadJson)
                    print(&#34;\tJob Queued: &#34; + loadJson.get(&#34;jobId&#34;))
                    print(&#34;\tJob def: &#34; + str(loadJson))

                    if waitForComplete:
                        print(&#34;waiting for job completion is not implemented yet&#34;)
                else:
                    print(&#34;\tjob not started &#34; + str(loadRc))
            else:
                print(&#34;file not uploaded - resource/scan will not be started&#34;)

    else:
        # file does not exist
        print(
            &#34;resource input file: &#34;
            + inputFileFullPath
            + &#34; invalid or does not exist, exiting&#34;
        )</code></pre>
</details>
</dd>
<dt id="edc_utilities.edcutils.createResource"><code class="name flex">
<span>def <span class="ident">createResource</span></span>(<span>url, user, pWd, resourceName, resourceJson)</span>
</code></dt>
<dd>
<div class="desc"><p>create a new resource based on the provided JSON</p>
<p>returns rc=200 (valid) &amp; other rc's from the put
resourceDef (json)</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def createResource(url, user, pWd, resourceName, resourceJson):
    &#34;&#34;&#34;
    create a new resource based on the provided JSON

    returns rc=200 (valid) &amp; other rc&#39;s from the put
            resourceDef (json)

    &#34;&#34;&#34;
    # create a new resource
    apiURL = url + &#34;/access/1/catalog/resources/&#34;
    header = {&#34;content-type&#34;: &#34;application/json&#34;}
    print(&#34;\tcreating resource: &#34; + resourceName)
    newResourceResp = requests.post(
        apiURL,
        data=json.dumps(resourceJson),
        headers=header,
        auth=HTTPBasicAuth(user, pWd),
        verify=False,
    )
    print(&#34;\trc=&#34; + str(newResourceResp.status_code))
    print(&#34;\tbody=&#34; + str(newResourceResp.text))

    return newResourceResp.status_code</code></pre>
</details>
</dd>
<dt id="edc_utilities.edcutils.createResourceUsingSession"><code class="name flex">
<span>def <span class="ident">createResourceUsingSession</span></span>(<span>url, session, resourceName, resourceJson)</span>
</code></dt>
<dd>
<div class="desc"><p>create a new resource based on the provided JSON
using a session that already has the auth (credentials)</p>
<p>returns rc=200 (valid) &amp; other rc's from the put
resourceDef (json)</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def createResourceUsingSession(url, session, resourceName, resourceJson):
    &#34;&#34;&#34;
    create a new resource based on the provided JSON
    using a session that already has the auth (credentials)

    returns rc=200 (valid) &amp; other rc&#39;s from the put
            resourceDef (json)

    &#34;&#34;&#34;
    # create a new resource
    apiURL = url + &#34;/access/1/catalog/resources/&#34;
    header = {&#34;content-type&#34;: &#34;application/json&#34;}
    print(&#34;\tcreating resource: &#34; + resourceName)
    newResourceResp = session.post(
        apiURL, data=json.dumps(resourceJson), headers=header
    )
    print(&#34;\trc=&#34; + str(newResourceResp.status_code))
    # print(&#34;\tbody=&#34; + str(newResourceResp.text))

    return newResourceResp.status_code</code></pre>
</details>
</dd>
<dt id="edc_utilities.edcutils.executeResourceLoad"><code class="name flex">
<span>def <span class="ident">executeResourceLoad</span></span>(<span>url, user, pWd, resourceName)</span>
</code></dt>
<dd>
<div class="desc"><p>start a resource load</p>
<p>returns rc=200 (valid) &amp; other rc's from the get
json with the job details</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def executeResourceLoad(url, user, pWd, resourceName):
    &#34;&#34;&#34;
    start a resource load

    returns rc=200 (valid) &amp; other rc&#39;s from the get
            json with the job details

    &#34;&#34;&#34;

    print(
        &#34;starting scan resource &#34; + url + &#34; resource=&#34; + resourceName + &#34; user=&#34; + user
    )
    apiURL = url + &#34;/access/2/catalog/resources/jobs/loads&#34;
    print(&#34;\turl=&#34; + apiURL)
    header = {&#34;accept&#34;: &#34;application/json&#34;, &#34;Content-Type&#34;: &#34;application/json&#34;}
    print(&#34;\t&#34; + str(header))
    params = {&#34;resource_name&#34;: resourceName}
    print(&#34;\t&#34; + str(params))
    uploadResp = requests.post(
        apiURL,
        data=json.dumps(params),
        headers=header,
        auth=HTTPBasicAuth(user, pWd),
        verify=False,
    )
    print(&#34;\tresponse=&#34; + str(uploadResp.status_code))
    if uploadResp.status_code == 200:
        # valid - return the jsom
        return uploadResp.status_code, json.loads(uploadResp.text)
    else:
        # not valid
        print(&#34;\tdarn - resource start failed&#34;)
        print(&#34;\t&#34; + str(uploadResp))
        print(&#34;\t&#34; + str(uploadResp.text))
        return uploadResp.status_code, None</code></pre>
</details>
</dd>
<dt id="edc_utilities.edcutils.executeResourceLoadUsingSession"><code class="name flex">
<span>def <span class="ident">executeResourceLoadUsingSession</span></span>(<span>url, session, resourceName)</span>
</code></dt>
<dd>
<div class="desc"><p>start a resource load</p>
<p>returns rc=200 (valid) &amp; other rc's from the get
json with the job details</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def executeResourceLoadUsingSession(url, session, resourceName):
    &#34;&#34;&#34;
    start a resource load

    returns rc=200 (valid) &amp; other rc&#39;s from the get
            json with the job details

    &#34;&#34;&#34;

    print(&#34;starting scan resource &#34; + url + &#34; resource=&#34; + resourceName)
    apiURL = url + &#34;/access/2/catalog/resources/jobs/loads&#34;
    print(&#34;\turl=&#34; + apiURL)
    header = {&#34;accept&#34;: &#34;application/json&#34;, &#34;Content-Type&#34;: &#34;application/json&#34;}
    print(&#34;\t&#34; + str(header))
    params = {&#34;resourceName&#34;: resourceName}
    print(&#34;\t&#34; + str(params))
    uploadResp = session.post(apiURL, data=json.dumps(params), headers=header)
    print(&#34;\tresponse=&#34; + str(uploadResp.status_code))
    if uploadResp.status_code == 200:
        # valid - return the jsom
        return uploadResp.status_code, json.loads(uploadResp.text)
    else:
        # not valid
        print(&#34;\tdarn - resource start failed&#34;)
        print(&#34;\t&#34; + str(uploadResp))
        print(&#34;\t&#34; + str(uploadResp.text))
        return uploadResp.status_code, None</code></pre>
</details>
</dd>
<dt id="edc_utilities.edcutils.exportLineageLink"><code class="name flex">
<span>def <span class="ident">exportLineageLink</span></span>(<span>fromObject, toObject, linkType, csvFile)</span>
</code></dt>
<dd>
<div class="desc"><p>write a custom lineage line to the csv file
assumptions
- csvFile is already created
- csv header is Association,From Connection,To Connection,From Object,To Object
Association=linkType, From Object=fromObject,To Object=toObject
From Connection and To Connection will be empty</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def exportLineageLink(fromObject, toObject, linkType, csvFile):
    &#34;&#34;&#34;
    write a custom lineage line to the csv file
    assumptions
      - csvFile is already created
      - csv header is Association,From Connection,To Connection,From Object,To Object
    Association=linkType, From Object=fromObject,To Object=toObject
    From Connection and To Connection will be empty
    &#34;&#34;&#34;
    # TODO: add error checking
    row = [linkType, &#34;&#34;, &#34;&#34;, fromObject, toObject]
    csvFile.writerow(row)
    return</code></pre>
</details>
</dd>
<dt id="edc_utilities.edcutils.getAllResource"><code class="name flex">
<span>def <span class="ident">getAllResource</span></span>(<span>url, user, pWd)</span>
</code></dt>
<dd>
<div class="desc"><p>get the resource definition - given a resource name (and catalog url)
catalog url should stop at port (e.g. not have ldmadmin, ldmcatalog etc&hellip;
or have v2 anywhere
since we are using v1 api's</p>
<p>returns rc=200 (valid) &amp; other rc's from the get
resourceDef (json)</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def getAllResource(url, user, pWd):
    &#34;&#34;&#34;
    get the resource definition - given a resource name (and catalog url)
    catalog url should stop at port (e.g. not have ldmadmin, ldmcatalog etc...
    or have v2 anywhere
    since we are using v1 api&#39;s

    returns rc=200 (valid) &amp; other rc&#39;s from the get
            resourceDef (json)

    &#34;&#34;&#34;

    print(&#34;getting resource for catalog:-&#34; + url + &#34; user=&#34; + user)
    apiURL = url + &#34;/access/1/catalog/resources/&#34;
    # print(&#34;\turl=&#34; + apiURL)
    header = {&#34;Accept&#34;: &#34;application/json&#34;}
    tResp = requests.get(
        apiURL, params={}, headers=header, auth=HTTPBasicAuth(user, pWd), verify=False
    )
    print(&#34;\tresponse=&#34; + str(tResp.status_code))
    if tResp.status_code == 200:
        # valid - return the jsom
        return tResp.status_code, json.loads(tResp.text)
    else:
        # not valid
        return tResp.status_code, None</code></pre>
</details>
</dd>
<dt id="edc_utilities.edcutils.getCatalogCustomAttr"><code class="name flex">
<span>def <span class="ident">getCatalogCustomAttr</span></span>(<span>url, user, pWd)</span>
</code></dt>
<dd>
<div class="desc"><p>call GET /access/2/catalog/models/attributes
this returns all attributes (system + custom)
filter for only the custom attributes (id startswith "com.infa.appmodels.ldm."</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def getCatalogCustomAttr(url, user, pWd):
    &#34;&#34;&#34;
    call GET /access/2/catalog/models/attributes
    this returns all attributes (system + custom)
    filter for only the custom attributes (id startswith &#34;com.infa.appmodels.ldm.&#34;
    &#34;&#34;&#34;

    resturl = url + &#34;/access/2/catalog/models/attributes&#34;
    header = {&#34;Accept&#34;: &#34;application/json&#34;}

    # set initial value for total to &gt; 0 - is over-written by the count of objects found
    total = 1000
    offset = 0
    page = 0
    pageSize = 200

    customAttrs = []

    while offset &lt; total:
        page += 1
        parameters = {&#34;offset&#34;: offset, &#34;pageSize&#34;: pageSize}

        # execute catalog rest call, for a page of results
        resp = requests.get(
            resturl,
            params=parameters,
            headers=header,
            auth=HTTPBasicAuth(user, pWd),
            verify=False,
        )
        status = resp.status_code
        if status != 200:
            # some error - e.g. catalog not running, or bad credentials
            print(&#34;error! &#34; + str(status) + str(resp.json()))
            break

        resultJson = resp.json()
        total = resultJson[&#34;metadata&#34;][&#34;totalCount&#34;]
        print(
            &#34;objects found: &#34;
            + str(total)
            + &#34; processing:&#34;
            + str(offset + 1)
            + &#34;-&#34;
            + str(offset + pageSize)
            + &#34; pagesize=&#34;
            + str(pageSize)
            + &#34; currentPage=&#34;
            + str(page)
        )

        # for next iteration
        offset += pageSize

        # for each attribute found...
        for attrDef in resultJson[&#34;items&#34;]:
            # attrCount+=1
            attrId = attrDef[&#34;id&#34;]
            if attrId.startswith(&#34;com.infa.appmodels.ldm.&#34;):
                customAttrs.append(attrDef)

    # end of while loop
    # print(&#34;&#34;)
    # print(&#34;Finished - run time = %s seconds ---&#34; % (time.time() - start_time))
    return customAttrs</code></pre>
</details>
</dd>
<dt id="edc_utilities.edcutils.getCatalogObjectCount"><code class="name flex">
<span>def <span class="ident">getCatalogObjectCount</span></span>(<span>url, user, pWd)</span>
</code></dt>
<dd>
<div class="desc"><p>get the resource object count - given a catalog url</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def getCatalogObjectCount(url, user, pWd):
    &#34;&#34;&#34;
    get the resource object count - given a catalog url
    &#34;&#34;&#34;

    print(&#34;getting object count for catalog resource:-&#34; + url + &#34; user=&#34; + user)
    apiURL = url + &#34;/access/2/catalog/data/objects&#34;
    return callGETRestEndpoint(apiURL, user, pWd)</code></pre>
</details>
</dd>
<dt id="edc_utilities.edcutils.getCatalogResourceCount"><code class="name flex">
<span>def <span class="ident">getCatalogResourceCount</span></span>(<span>url, user, pWd)</span>
</code></dt>
<dd>
<div class="desc"><p>get the resource count - given a catalog url</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def getCatalogResourceCount(url, user, pWd):
    &#34;&#34;&#34;
    get the resource count - given a catalog url
    &#34;&#34;&#34;

    apiURL = url + &#34;/access/2/catalog/data/objects?q=core.allclassTypes:core.Resource&#34;
    print(&#34;getting object count for catalog resource:-&#34; + apiURL + &#34; user=&#34; + user)
    return callGETRestEndpoint(apiURL, user, pWd)</code></pre>
</details>
</dd>
<dt id="edc_utilities.edcutils.getResourceDef"><code class="name flex">
<span>def <span class="ident">getResourceDef</span></span>(<span>url, user, pWd, resourceName, sensitiveOptions=False)</span>
</code></dt>
<dd>
<div class="desc"><p>get the resource definition - given a resource name (and catalog url)
catalog url should stop at port (e.g. not have ldmadmin, ldmcatalog etc&hellip;
or have v2 anywhere
since we are using v1 api's</p>
<p>returns rc=200 (valid) &amp; other rc's from the get
resourceDef (json)</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def getResourceDef(url, user, pWd, resourceName, sensitiveOptions=False):
    &#34;&#34;&#34;
    get the resource definition - given a resource name (and catalog url)
    catalog url should stop at port (e.g. not have ldmadmin, ldmcatalog etc...
    or have v2 anywhere
    since we are using v1 api&#39;s

    returns rc=200 (valid) &amp; other rc&#39;s from the get
            resourceDef (json)

    &#34;&#34;&#34;

    print(
        &#34;getting resource for catalog:-&#34;
        + url
        + &#34; resource=&#34;
        + resourceName
        + &#34; user=&#34;
        + user
    )
    apiURL = url + &#34;/access/1/catalog/resources/&#34; + resourceName
    if sensitiveOptions:
        apiURL += &#34;?sensitiveOptions=true&#34;
    # print(&#34;\turl=&#34; + apiURL)
    header = {&#34;Accept&#34;: &#34;application/json&#34;}
    tResp = requests.get(
        apiURL, params={}, headers=header, auth=HTTPBasicAuth(user, pWd), verify=False
    )
    print(&#34;\tresponse=&#34; + str(tResp.status_code))
    if tResp.status_code == 200:
        # valid - return the jsom
        return tResp.status_code, json.loads(tResp.text)
    else:
        # not valid
        return tResp.status_code, None</code></pre>
</details>
</dd>
<dt id="edc_utilities.edcutils.getResourceDefUsingSession"><code class="name flex">
<span>def <span class="ident">getResourceDefUsingSession</span></span>(<span>url, session, resourceName, sensitiveOptions=False)</span>
</code></dt>
<dd>
<div class="desc"><p>get the resource definition - given a resource name (and catalog url)
catalog url should stop at port (e.g. not have ldmadmin, ldmcatalog etc&hellip;
or have v2 anywhere
since we are using v1 api's</p>
<p>returns rc=200 (valid) &amp; other rc's from the get
resourceDef (json)</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def getResourceDefUsingSession(url, session, resourceName, sensitiveOptions=False):
    &#34;&#34;&#34;
    get the resource definition - given a resource name (and catalog url)
    catalog url should stop at port (e.g. not have ldmadmin, ldmcatalog etc...
    or have v2 anywhere
    since we are using v1 api&#39;s

    returns rc=200 (valid) &amp; other rc&#39;s from the get
            resourceDef (json)

    &#34;&#34;&#34;

    print(
        &#34;getting resource for catalog:-&#34;
        + url
        + &#34; resource=&#34;
        + resourceName
    )
    apiURL = url + &#34;/access/1/catalog/resources/&#34; + resourceName
    if sensitiveOptions:
        apiURL += &#34;?sensitiveOptions=true&#34;
    # print(&#34;\turl=&#34; + apiURL)
    header = {&#34;Accept&#34;: &#34;application/json&#34;}
    tResp = session.get(apiURL, params={}, headers=header, )
    print(&#34;\tresponse=&#34; + str(tResp.status_code))
    if tResp.status_code == 200:
        # valid - return the jsom
        return tResp.status_code, json.loads(tResp.text)
    else:
        # not valid
        return tResp.status_code, None</code></pre>
</details>
</dd>
<dt id="edc_utilities.edcutils.getResourceObjectCount"><code class="name flex">
<span>def <span class="ident">getResourceObjectCount</span></span>(<span>url, user, pWd, resourceName)</span>
</code></dt>
<dd>
<div class="desc"><p>get the resource object count - given a resource name (and catalog url)</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def getResourceObjectCount(url, user, pWd, resourceName):
    &#34;&#34;&#34;
    get the resource object count - given a resource name (and catalog url)
    &#34;&#34;&#34;

    apiURL = url + &#34;/access/2/catalog/data/objects?q=core.resource_name:&#34; + resourceName
    print(
        &#34;getting object count for catalog resource:-&#34;
        + apiURL
        + &#34; resource=&#34;
        + resourceName
        + &#34; user=&#34;
        + user
    )
    return callGETRestEndpoint(apiURL, user, pWd)</code></pre>
</details>
</dd>
<dt id="edc_utilities.edcutils.getReusableScannerConfig"><code class="name flex">
<span>def <span class="ident">getReusableScannerConfig</span></span>(<span>url, user, pWd)</span>
</code></dt>
<dd>
<div class="desc"><p>get the reusable configuration - given a catalog url</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def getReusableScannerConfig(url, user, pWd):
    &#34;&#34;&#34;
    get the reusable configuration - given a catalog url
    &#34;&#34;&#34;

    apiURL = url + &#34;/access/1/catalog/resources/reusablescannerconfigs&#34;
    print(&#34;getting the reusable configuration:-&#34; + apiURL + &#34; user=&#34; + user)
    return callGETRestEndpoint(apiURL, user, pWd)</code></pre>
</details>
</dd>
<dt id="edc_utilities.edcutils.get_fact_value"><code class="name flex">
<span>def <span class="ident">get_fact_value</span></span>(<span>item, attribute_name, json_property)</span>
</code></dt>
<dd>
<div class="desc"><p>returns the value of a fact (attribute) from an item</p>
<p>iterates over the "facts" list - looking for a matching attributeId
to the parameter attribute_name
returns the "value" json_property or ""</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_fact_value(item, attribute_name, json_property):
    &#34;&#34;&#34;
    returns the value of a fact (attribute) from an item

    iterates over the &#34;facts&#34; list - looking for a matching attributeId
    to the parameter attribute_name
    returns the &#34;value&#34; json_property or &#34;&#34;
    &#34;&#34;&#34;
    # get the value of a specific fact from an item
    value = &#34;&#34;
    for facts in item[&#34;facts&#34;]:
        if facts.get(&#34;attributeId&#34;) == attribute_name:
            value = facts.get(json_property)
            if value is None:
                value = &#34;&#34;
            break
    return value</code></pre>
</details>
</dd>
<dt id="edc_utilities.edcutils.updateResourceDef"><code class="name flex">
<span>def <span class="ident">updateResourceDef</span></span>(<span>url, user, pWd, resourceName, resJson)</span>
</code></dt>
<dd>
<div class="desc"><p>update a setting in an existing resource</p>
<p>returns rc=200 (valid) &amp; other rc's from the put
resourceDef (json)</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def updateResourceDef(url, user, pWd, resourceName, resJson):
    &#34;&#34;&#34;
    update a setting in an existing resource

    returns rc=200 (valid) &amp; other rc&#39;s from the put
            resourceDef (json)

    &#34;&#34;&#34;

    print(
        &#34;\tupdating resource for catalog:-&#34;
        + url
        + &#34; resource=&#34;
        + resourceName
        + &#34; user=&#34;
        + user
    )
    print(&#34;\t&#34; + json.dumps(resJson))
    apiURL = url + &#34;/access/1/catalog/resources/&#34; + resourceName
    print(&#34;\turl=&#34; + apiURL)
    header = {&#34;Accept&#34;: &#34;application/json&#34;, &#34;Content-Type&#34;: &#34;application/json&#34;}
    tResp = requests.put(
        apiURL,
        data=json.dumps(resJson),
        headers=header,
        auth=HTTPBasicAuth(user, pWd),
        verify=False,
    )
    print(&#34;\tresponse=&#34; + str(tResp.status_code))
    if tResp.status_code == 200:
        # valid - return the jsom
        print(&#34;\tyay - update resource worked...&#34;)
        print(tResp)
        return tResp.status_code
    else:
        # not valid
        print(&#34;\tdarn - update resource failed...&#34;)
        print(tResp)
        return tResp.status_code</code></pre>
</details>
</dd>
<dt id="edc_utilities.edcutils.uploadResourceFile"><code class="name flex">
<span>def <span class="ident">uploadResourceFile</span></span>(<span>url, user, pWd, resourceName, fileName, fullPath, scannerId)</span>
</code></dt>
<dd>
<div class="desc"><p>upload a file for the resource - e.g. a custom lineage csv file
works with either csv for zip files
(.csv|.zip)</p>
<p>returns rc=200 (valid) &amp; other rc's from the post</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def uploadResourceFile(url, user, pWd, resourceName, fileName, fullPath, scannerId):
    &#34;&#34;&#34;
    upload a file for the resource - e.g. a custom lineage csv file
    works with either csv for zip files  (.csv|.zip)

    returns rc=200 (valid) &amp; other rc&#39;s from the post

    &#34;&#34;&#34;
    print(
        &#34;uploading file for resource &#34;
        + url
        + &#34; resource=&#34;
        + resourceName
        + &#34; user=&#34;
        + user
    )
    apiURL = url + &#34;/access/1/catalog/resources/&#34; + resourceName + &#34;/files&#34;
    print(&#34;\turl=&#34; + apiURL)
    # header = {&#34;accept&#34;: &#34;*/*&#34;, &#34;Content-Type&#34; : &#34;multipart/form-data&#34;}
    header = {&#34;accept&#34;: &#34;*/*&#34;}
    print(&#34;\t&#34; + str(header))
    # params={&#34;scannerid&#34;: &#34;LineageScanner&#34;, &#34;filename&#34;: fileName, &#34;optionid&#34;: &#34;File&#34;}
    params = {&#34;scannerid&#34;: scannerId, &#34;filename&#34;: fileName, &#34;optionid&#34;: &#34;File&#34;}
    print(&#34;\t&#34; + str(params))
    #     files = {&#39;file&#39;: fullPath}
    mimeType = &#34;text/csv&#34;
    readMode = &#34;rt&#34;
    if fileName.endswith(&#34;.zip&#34;):
        mimeType = &#34;application/zip&#34;
        readMode = &#34;rb&#34;

    if fileName.endswith(&#34;.dsx&#34;):
        mimeType = &#34;text/plain&#34;

    file = {&#34;file&#34;: (fileName, open(fullPath, readMode), mimeType)}
    print(&#34;\t&#34; + str(file))
    uploadResp = requests.post(
        apiURL,
        data=params,
        files=file,
        headers=header,
        auth=HTTPBasicAuth(user, pWd),
        verify=False,
    )
    print(&#34;\tresponse=&#34; + str(uploadResp.status_code))
    if uploadResp.status_code == 200:
        # valid - return the jsom
        return uploadResp.status_code
    else:
        # not valid
        print(&#34;\tupload file failed&#34;)
        print(&#34;\t&#34; + str(uploadResp))
        print(&#34;\t&#34; + str(uploadResp.text))
        return uploadResp.status_code</code></pre>
</details>
</dd>
<dt id="edc_utilities.edcutils.uploadResourceFileUsingSession"><code class="name flex">
<span>def <span class="ident">uploadResourceFileUsingSession</span></span>(<span>url, session, resourceName, fileName, fullPath, scannerId)</span>
</code></dt>
<dd>
<div class="desc"><p>upload a file for the resource - e.g. a custom lineage csv file
works with either csv for zip files
(.csv|.zip)</p>
<p>returns rc=200 (valid) &amp; other rc's from the post</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def uploadResourceFileUsingSession(url, session, resourceName, fileName, fullPath, scannerId):
    &#34;&#34;&#34;
    upload a file for the resource - e.g. a custom lineage csv file
    works with either csv for zip files  (.csv|.zip)

    returns rc=200 (valid) &amp; other rc&#39;s from the post

    &#34;&#34;&#34;
    print(
        &#34;uploading file for resource &#34;
        + url
        + &#34; resource=&#34;
        + resourceName
    )
    apiURL = url + &#34;/access/1/catalog/resources/&#34; + resourceName + &#34;/files&#34;
    print(&#34;\turl=&#34; + apiURL)
    # header = {&#34;accept&#34;: &#34;*/*&#34;, }
    params = {&#34;scannerid&#34;: scannerId, &#34;filename&#34;: fileName, &#34;optionid&#34;: &#34;File&#34;}
    print(&#34;\t&#34; + str(params))
    #     files = {&#39;file&#39;: fullPath}
    mimeType = &#34;text/csv&#34;
    readMode = &#34;rt&#34;
    if fileName.endswith(&#34;.zip&#34;):
        mimeType = &#34;application/zip&#34;
        readMode = &#34;rb&#34;

    if fileName.endswith(&#34;.dsx&#34;):
        mimeType = &#34;text/plain&#34;

    file = {&#34;file&#34;: (fileName, open(fullPath, readMode), mimeType)}
    # file = {&#34;file&#34;: (fileName, open(fullPath, readMode), )}
    print(f&#34;\t{file}&#34;)
    # print(f&#34;session header:{session.headers}&#34;)
    uploadResp = session.post(
        apiURL,
        data=params,
        files=file,
    )
    print(&#34;\tresponse=&#34; + str(uploadResp.status_code))
    if uploadResp.status_code == 200:
        # valid - return the json
        return uploadResp.status_code
    else:
        # not valid
        print(&#34;\tupload file failed&#34;)
        print(&#34;\t&#34; + str(uploadResp))
        print(&#34;\t&#34; + str(uploadResp.text))
        return uploadResp.status_code</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="edc_utilities" href="index.html">edc_utilities</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="edc_utilities.edcutils.callGETRestEndpoint" href="#edc_utilities.edcutils.callGETRestEndpoint">callGETRestEndpoint</a></code></li>
<li><code><a title="edc_utilities.edcutils.createAttribute" href="#edc_utilities.edcutils.createAttribute">createAttribute</a></code></li>
<li><code><a title="edc_utilities.edcutils.createOrUpdateAndExecuteResource" href="#edc_utilities.edcutils.createOrUpdateAndExecuteResource">createOrUpdateAndExecuteResource</a></code></li>
<li><code><a title="edc_utilities.edcutils.createOrUpdateAndExecuteResourceUsingSession" href="#edc_utilities.edcutils.createOrUpdateAndExecuteResourceUsingSession">createOrUpdateAndExecuteResourceUsingSession</a></code></li>
<li><code><a title="edc_utilities.edcutils.createResource" href="#edc_utilities.edcutils.createResource">createResource</a></code></li>
<li><code><a title="edc_utilities.edcutils.createResourceUsingSession" href="#edc_utilities.edcutils.createResourceUsingSession">createResourceUsingSession</a></code></li>
<li><code><a title="edc_utilities.edcutils.executeResourceLoad" href="#edc_utilities.edcutils.executeResourceLoad">executeResourceLoad</a></code></li>
<li><code><a title="edc_utilities.edcutils.executeResourceLoadUsingSession" href="#edc_utilities.edcutils.executeResourceLoadUsingSession">executeResourceLoadUsingSession</a></code></li>
<li><code><a title="edc_utilities.edcutils.exportLineageLink" href="#edc_utilities.edcutils.exportLineageLink">exportLineageLink</a></code></li>
<li><code><a title="edc_utilities.edcutils.getAllResource" href="#edc_utilities.edcutils.getAllResource">getAllResource</a></code></li>
<li><code><a title="edc_utilities.edcutils.getCatalogCustomAttr" href="#edc_utilities.edcutils.getCatalogCustomAttr">getCatalogCustomAttr</a></code></li>
<li><code><a title="edc_utilities.edcutils.getCatalogObjectCount" href="#edc_utilities.edcutils.getCatalogObjectCount">getCatalogObjectCount</a></code></li>
<li><code><a title="edc_utilities.edcutils.getCatalogResourceCount" href="#edc_utilities.edcutils.getCatalogResourceCount">getCatalogResourceCount</a></code></li>
<li><code><a title="edc_utilities.edcutils.getResourceDef" href="#edc_utilities.edcutils.getResourceDef">getResourceDef</a></code></li>
<li><code><a title="edc_utilities.edcutils.getResourceDefUsingSession" href="#edc_utilities.edcutils.getResourceDefUsingSession">getResourceDefUsingSession</a></code></li>
<li><code><a title="edc_utilities.edcutils.getResourceObjectCount" href="#edc_utilities.edcutils.getResourceObjectCount">getResourceObjectCount</a></code></li>
<li><code><a title="edc_utilities.edcutils.getReusableScannerConfig" href="#edc_utilities.edcutils.getReusableScannerConfig">getReusableScannerConfig</a></code></li>
<li><code><a title="edc_utilities.edcutils.get_fact_value" href="#edc_utilities.edcutils.get_fact_value">get_fact_value</a></code></li>
<li><code><a title="edc_utilities.edcutils.updateResourceDef" href="#edc_utilities.edcutils.updateResourceDef">updateResourceDef</a></code></li>
<li><code><a title="edc_utilities.edcutils.uploadResourceFile" href="#edc_utilities.edcutils.uploadResourceFile">uploadResourceFile</a></code></li>
<li><code><a title="edc_utilities.edcutils.uploadResourceFileUsingSession" href="#edc_utilities.edcutils.uploadResourceFileUsingSession">uploadResourceFileUsingSession</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.9.2</a>.</p>
</footer>
</body>
</html>